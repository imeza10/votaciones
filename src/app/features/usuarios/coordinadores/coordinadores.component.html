<div class="coordinadores-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Gesti√≥n de Coordinadores</h1>
      <p class="subtitle">Administra los coordinadores del sistema electoral</p>
    </div>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <i class="icon">‚ûï</i>
      Nuevo Coordinador
    </button>
  </div>

  <!-- Filtros -->
  <div class="filters-card">
    <div class="filters-grid">
      <div class="filter-group">
        <label>Buscar</label>
        <input 
          type="text" 
          class="form-control"
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          placeholder="Documento, nombre, apellidos..."
        />
      </div>

      <div class="filter-group">
        <label>Estado</label>
        <select 
          class="form-control"
          [(ngModel)]="filterActivo"
          (change)="onFilterChange()"
        >
          <option value="">Todos</option>
          <option value="1">Activos</option>
          <option value="0">Inactivos</option>
        </select>
      </div>

      <div class="filter-group">
        <label>&nbsp;</label>
        <button class="btn btn-secondary" (click)="clearFilters()">
          Limpiar Filtros
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla -->
  <div class="table-card">
    <div *ngIf="loading()" class="loading-overlay">
      <div class="spinner"></div>
      <p>Cargando...</p>
    </div>

    <div *ngIf="!loading() && coordinadores().length === 0" class="empty-state">
      <div class="empty-icon">üë•</div>
      <h3>No hay coordinadores registrados</h3>
      <p>Comienza agregando tu primer coordinador</p>
      <button class="btn btn-primary" (click)="openCreateModal()">
        Crear Primer Coordinador
      </button>
    </div>

    <div *ngIf="!loading() && coordinadores().length > 0" class="table-responsive">
      <table class="data-table">
        <thead>
          <tr>
            <th>Documento</th>
            <th>Nombre Completo</th>
            <th>Tel√©fono</th>
            <th>Email</th>
            <th>Total L√≠deres</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let coordinador of coordinadores()">
            <td>{{ coordinador.documento }}</td>
            <td>{{ coordinador.nombre }} {{ coordinador.apellidos }}</td>
            <td>{{ coordinador.telefono || '-' }}</td>
            <td>{{ coordinador.email || '-' }}</td>
            <td>
              <span class="badge-info">{{ coordinador.total_lideres || 0 }} l√≠deres</span>
            </td>
            <td>
              <span 
                class="badge" 
                [ngClass]="getEstadoBadgeClass(coordinador.activo)"
              >
                {{ getEstadoText(coordinador.activo) }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button 
                  class="btn-icon btn-edit" 
                  (click)="openEditModal(coordinador)"
                  title="Editar"
                >
                  ‚úèÔ∏è
                </button>
                <button 
                  class="btn-icon btn-toggle" 
                  (click)="cambiarEstado(coordinador)"
                  [title]="coordinador.activo ? 'Desactivar' : 'Activar'"
                >
                  {{ coordinador.activo ? 'üîí' : 'üîì' }}
                </button>
                <button 
                  class="btn-icon btn-delete" 
                  (click)="openDeleteModal(coordinador)"
                  title="Eliminar"
                >
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginaci√≥n -->
    <div *ngIf="!loading() && coordinadores().length > 0" class="pagination">
      <div class="pagination-info">
        Mostrando {{ (currentPage - 1) * perPage + 1 }} - 
        {{ Math.min(currentPage * perPage, totalRecords) }} de {{ totalRecords }} coordinadores
      </div>
      <div class="pagination-buttons">
        <button 
          class="btn btn-sm"
          [disabled]="currentPage === 1"
          (click)="onPageChange(currentPage - 1)"
        >
          Anterior
        </button>
        <span class="page-info">P√°gina {{ currentPage }} de {{ totalPages }}</span>
        <button 
          class="btn btn-sm"
          [disabled]="currentPage === totalPages"
          (click)="onPageChange(currentPage + 1)"
        >
          Siguiente
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Crear/Editar -->
  <div class="modal-overlay" *ngIf="showModal()" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ modalMode === 'crear' ? 'Nuevo Coordinador' : 'Editar Coordinador' }}</h2>
        <button class="btn-close" (click)="closeModal()">‚úï</button>
      </div>

      <form [formGroup]="coordinadorForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div *ngIf="formErrors.length > 0" class="alert alert-error">
            <ul>
              <li *ngFor="let error of formErrors">{{ error }}</li>
            </ul>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Nombre *</label>
              <input 
                type="text" 
                class="form-control"
                formControlName="nombre"
                placeholder="Nombre del coordinador"
              />
              <span class="error" *ngIf="coordinadorForm.get('nombre')?.invalid && coordinadorForm.get('nombre')?.touched">
                El nombre es requerido
              </span>
            </div>

            <div class="form-group">
              <label>Apellidos *</label>
              <input 
                type="text" 
                class="form-control"
                formControlName="apellidos"
                placeholder="Apellidos del coordinador"
              />
              <span class="error" *ngIf="coordinadorForm.get('apellidos')?.invalid && coordinadorForm.get('apellidos')?.touched">
                Los apellidos son requeridos
              </span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Documento *</label>
              <input 
                type="text" 
                class="form-control"
                formControlName="documento"
                placeholder="N√∫mero de documento"
              />
              <span class="error" *ngIf="coordinadorForm.get('documento')?.invalid && coordinadorForm.get('documento')?.touched">
                Documento inv√°lido (6-10 d√≠gitos)
              </span>
            </div>

            <div class="form-group">
              <label>Tel√©fono</label>
              <input 
                type="text" 
                class="form-control"
                formControlName="telefono"
                placeholder="3001234567"
              />
              <span class="error" *ngIf="coordinadorForm.get('telefono')?.invalid && coordinadorForm.get('telefono')?.touched">
                Tel√©fono inv√°lido (10 d√≠gitos)
              </span>
            </div>
          </div>

          <div class="form-group">
            <label>Email</label>
            <input 
              type="email" 
              class="form-control"
              formControlName="email"
              placeholder="correo@ejemplo.com"
            />
            <span class="error" *ngIf="coordinadorForm.get('email')?.invalid && coordinadorForm.get('email')?.touched">
              Email inv√°lido
            </span>
          </div>

          <div class="form-group">
            <label>{{ modalMode === 'crear' ? 'Contrase√±a *' : 'Nueva Contrase√±a (dejar vac√≠o para mantener)' }}</label>
            <input 
              type="password" 
              class="form-control"
              formControlName="password"
              placeholder="M√≠nimo 6 caracteres"
            />
            <span class="error" *ngIf="coordinadorForm.get('password')?.invalid && coordinadorForm.get('password')?.touched">
              Contrase√±a inv√°lida (m√≠nimo 6 caracteres)
            </span>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="activo" />
              Coordinador activo
            </label>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="loading()">
            {{ loading() ? 'Guardando...' : (modalMode === 'crear' ? 'Crear Coordinador' : 'Actualizar') }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Eliminar -->
  <div class="modal-overlay" *ngIf="showDeleteModal()" (click)="closeDeleteModal()">
    <div class="modal-content modal-confirm" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Confirmar Eliminaci√≥n</h2>
        <button class="btn-close" (click)="closeDeleteModal()">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="confirm-icon">‚ö†Ô∏è</div>
        <p>¬øEst√° seguro que desea eliminar este coordinador?</p>
        <p class="confirm-name">
          <strong>{{ selectedCoordinador?.nombre }} {{ selectedCoordinador?.apellidos }}</strong>
          <br>
          <small>{{ selectedCoordinador?.documento }}</small>
        </p>
        <div class="alert alert-warning">
          No se puede eliminar un coordinador con l√≠deres asignados. Esta acci√≥n no se puede deshacer.
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDeleteModal()">
          Cancelar
        </button>
        <button class="btn btn-danger" (click)="confirmDelete()" [disabled]="loading()">
          {{ loading() ? 'Eliminando...' : 'S√≠, Eliminar' }}
        </button>
      </div>
    </div>
  </div>
</div>
