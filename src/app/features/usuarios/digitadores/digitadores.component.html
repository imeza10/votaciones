<div class="digitadores-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Gesti√≥n de Digitadores</h1>
      <p class="subtitle">Administra los digitadores del sistema electoral</p>
    </div>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <i class="icon">‚ûï</i>
      Nuevo Digitador
    </button>
  </div>

  <!-- Filtros -->
  <div class="filters-card">
    <div class="filters-grid">
      <div class="filter-group">
        <label>Buscar</label>
        <input 
          type="text" 
          class="form-control"
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          placeholder="Documento, nombre, apellidos..."
        />
      </div>

      <div class="filter-group">
        <label>Coordinador</label>
        <select 
          class="form-control"
          [(ngModel)]="filterCoordinador"
          (change)="onFilterChange()"
        >
          <option value="">Todos los coordinadores</option>
          <option *ngFor="let coord of coordinadores()" [value]="coord.id">
            {{ coord.nombre }} {{ coord.apellidos }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label>Estado</label>
        <select 
          class="form-control"
          [(ngModel)]="filterActivo"
          (change)="onFilterChange()"
        >
          <option value="">Todos</option>
          <option value="1">Activos</option>
          <option value="0">Inactivos</option>
        </select>
      </div>

      <div class="filter-group">
        <label>&nbsp;</label>
        <button class="btn btn-secondary" (click)="clearFilters()">
          Limpiar Filtros
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla -->
  <div class="table-card">
    <div *ngIf="loading()" class="loading-overlay">
      <div class="spinner"></div>
      <p>Cargando...</p>
    </div>

    <div *ngIf="!loading() && digitadores().length === 0" class="empty-state">
      <div class="empty-icon">‚å®Ô∏è</div>
      <h3>No hay digitadores registrados</h3>
      <p>Comienza agregando tu primer digitador</p>
      <button class="btn btn-primary" (click)="openCreateModal()">
        Crear Primer Digitador
      </button>
    </div>

    <div *ngIf="!loading() && digitadores().length > 0" class="table-responsive">
      <table class="data-table">
        <thead>
          <tr>
            <th>Documento</th>
            <th>Nombre Completo</th>
            <th>Tel√©fono</th>
            <th>Email</th>
            <th>Coordinador</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let digitador of digitadores()">
            <td>{{ digitador.documento }}</td>
            <td>{{ digitador.nombre }} {{ digitador.apellidos }}</td>
            <td>{{ digitador.telefono || '-' }}</td>
            <td>{{ digitador.email || '-' }}</td>
            <td>
              <span *ngIf="digitador.coordinador_id">{{ digitador.coordinador_nombre }}</span>
              <span *ngIf="!digitador.coordinador_id" class="text-muted">Sin asignar</span>
            </td>
            <td>
              <span 
                class="badge" 
                [ngClass]="getEstadoBadgeClass(digitador.activo)"
              >
                {{ getEstadoText(digitador.activo) }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button 
                  class="btn-icon btn-edit" 
                  (click)="openEditModal(digitador)"
                  title="Editar"
                >
                  ‚úèÔ∏è
                </button>
                <button 
                  class="btn-icon btn-toggle" 
                  (click)="cambiarEstado(digitador)"
                  [title]="digitador.activo ? 'Desactivar' : 'Activar'"
                >
                  {{ digitador.activo ? 'üîí' : 'üîì' }}
                </button>
                <button 
                  class="btn-icon btn-delete" 
                  (click)="openDeleteModal(digitador)"
                  title="Eliminar"
                >
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginaci√≥n -->
    <div *ngIf="!loading() && digitadores().length > 0" class="pagination">
      <div class="pagination-info">
        Mostrando {{ (currentPage - 1) * perPage + 1 }} - 
        {{ Math.min(currentPage * perPage, totalRecords) }} de {{ totalRecords }} digitadores
      </div>
      <div class="pagination-buttons">
        <button 
          class="btn btn-sm"
          [disabled]="currentPage === 1"
          (click)="onPageChange(currentPage - 1)"
        >
          Anterior
        </button>
        <span class="page-info">P√°gina {{ currentPage }} de {{ totalPages }}</span>
        <button 
          class="btn btn-sm"
          [disabled]="currentPage === totalPages"
          (click)="onPageChange(currentPage + 1)"
        >
          Siguiente
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Crear/Editar -->
  <div class="modal-overlay" *ngIf="showModal()" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ modalMode === 'crear' ? 'Nuevo Digitador' : 'Editar Digitador' }}</h2>
        <button class="btn-close" (click)="closeModal()">‚úï</button>
      </div>

      <form [formGroup]="digitadorForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div *ngIf="formErrors.length > 0" class="alert alert-error">
            <ul>
              <li *ngFor="let error of formErrors">{{ error }}</li>
            </ul>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Nombre *</label>
              <input 
                type="text" 
                class="form-control"
                formControlName="nombre"
                placeholder="Nombre del digitador"
              />
              <span class="error" *ngIf="digitadorForm.get('nombre')?.invalid && digitadorForm.get('nombre')?.touched">
                El nombre es requerido
              </span>
            </div>

            <div class="form-group">
              <label>Apellidos *</label>
              <input 
                type="text" 
                class="form-control"
                formControlName="apellidos"
                placeholder="Apellidos del digitador"
              />
              <span class="error" *ngIf="digitadorForm.get('apellidos')?.invalid && digitadorForm.get('apellidos')?.touched">
                Los apellidos son requeridos
              </span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Documento *</label>
              <input 
                type="text" 
                class="form-control"
                formControlName="documento"
                placeholder="N√∫mero de documento"
              />
              <span class="error" *ngIf="digitadorForm.get('documento')?.invalid && digitadorForm.get('documento')?.touched">
                Documento inv√°lido (6-10 d√≠gitos)
              </span>
            </div>

            <div class="form-group">
              <label>Tel√©fono</label>
              <input 
                type="text" 
                class="form-control"
                formControlName="telefono"
                placeholder="3001234567"
              />
              <span class="error" *ngIf="digitadorForm.get('telefono')?.invalid && digitadorForm.get('telefono')?.touched">
                Tel√©fono inv√°lido (10 d√≠gitos)
              </span>
            </div>
          </div>

          <div class="form-group">
            <label>Email</label>
            <input 
              type="email" 
              class="form-control"
              formControlName="email"
              placeholder="correo@ejemplo.com"
            />
            <span class="error" *ngIf="digitadorForm.get('email')?.invalid && digitadorForm.get('email')?.touched">
              Email inv√°lido
            </span>
          </div>

          <div class="form-group">
            <label>Coordinador *</label>
            <select class="form-control" formControlName="coordinador_id">
              <option value="">Seleccione un coordinador</option>
              <option *ngFor="let coord of coordinadores()" [value]="coord.id">
                {{ coord.nombre }} {{ coord.apellidos }}
              </option>
            </select>
            <span class="error" *ngIf="digitadorForm.get('coordinador_id')?.invalid && digitadorForm.get('coordinador_id')?.touched">
              El coordinador es requerido
            </span>
          </div>

          <div class="form-group">
            <label>{{ modalMode === 'crear' ? 'Contrase√±a *' : 'Nueva Contrase√±a (dejar vac√≠o para mantener)' }}</label>
            <input 
              type="password" 
              class="form-control"
              formControlName="password"
              placeholder="M√≠nimo 6 caracteres"
            />
            <span class="error" *ngIf="digitadorForm.get('password')?.invalid && digitadorForm.get('password')?.touched">
              Contrase√±a inv√°lida (m√≠nimo 6 caracteres)
            </span>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="activo" />
              Digitador activo
            </label>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="loading()">
            {{ loading() ? 'Guardando...' : (modalMode === 'crear' ? 'Crear Digitador' : 'Actualizar') }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Eliminar -->
  <div class="modal-overlay" *ngIf="showDeleteModal()" (click)="closeDeleteModal()">
    <div class="modal-content modal-confirm" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Confirmar Eliminaci√≥n</h2>
        <button class="btn-close" (click)="closeDeleteModal()">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="confirm-icon">‚ö†Ô∏è</div>
        <p>¬øEst√° seguro que desea eliminar este digitador?</p>
        <p class="confirm-name">
          <strong>{{ selectedDigitador?.nombre }} {{ selectedDigitador?.apellidos }}</strong>
          <br>
          <small>{{ selectedDigitador?.documento }}</small>
        </p>
        <div class="alert alert-warning">
          Esta acci√≥n no se puede deshacer.
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDeleteModal()">
          Cancelar
        </button>
        <button class="btn btn-danger" (click)="confirmDelete()" [disabled]="loading()">
          {{ loading() ? 'Eliminando...' : 'S√≠, Eliminar' }}
        </button>
      </div>
    </div>
  </div>
</div>
